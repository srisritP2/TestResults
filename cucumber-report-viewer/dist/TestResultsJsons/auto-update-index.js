#!/usr/bin/env node
const fs=require("fs"),path=require("path"),{execSync}=require("child_process"),REPORTS_DIR=__dirname,INDEX_FILE=path.join(REPORTS_DIR,"index.json"),STATS_FILE=path.join(REPORTS_DIR,"stats.json");console.log("ğŸ” Checking for new reports...");try{const e=execSync("git status --porcelain",{encoding:"utf-8"}),o=e.split("\n").some(e=>e.includes(".json")&&e.includes("TestResultsJsons"));o||(console.log("âœ… No new reports found. Index is up to date."),process.exit(0)),console.log("ğŸ“Š New reports detected! Updating index..."),execSync("node generate-index-enhanced.js",{cwd:REPORTS_DIR,stdio:"inherit"}),console.log("âœ… Index updated successfully!");const n=process.argv.slice(2);n.includes("--commit")?(console.log("ğŸ“ Committing changes..."),execSync("git add .",{cwd:path.join(REPORTS_DIR,"../.."),stdio:"inherit"}),execSync('git commit -m "Auto-update: Add new test report and regenerate index"',{cwd:path.join(REPORTS_DIR,"../.."),stdio:"inherit"}),n.includes("--push")?(console.log("ğŸš€ Pushing to GitHub..."),execSync("git push origin main",{cwd:path.join(REPORTS_DIR,"../.."),stdio:"inherit"}),console.log("âœ… Changes pushed to GitHub!"),console.log("â³ Wait 2-3 minutes for GitHub Pages deployment")):console.log('âœ… Changes committed. Run "git push origin main" to deploy.')):(console.log("ğŸ’¡ Tip: Run with --commit to auto-commit, or --commit --push to auto-push"),console.log("   Example: node auto-update-index.js --commit --push"))}catch(error){console.error("âŒ Error:",error.message),process.exit(1)}