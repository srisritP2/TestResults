const fs=require("fs"),path=require("path"),reportsDir=__dirname,files=fs.readdirSync(reportsDir).filter(e=>e.startsWith("gct-")&&e.endsWith(".json"));console.log(`\nğŸ” Scanning ${files.length} report files...\n`);const issues={empty:[],invalid:[],duplicates:new Map};files.forEach(e=>{const s=path.join(reportsDir,e),l=fs.statSync(s);try{const o=fs.readFileSync(s,"utf8"),i=JSON.parse(o);if(!Array.isArray(i))return void issues.invalid.push({file:e,reason:"Not an array"});if(i.length>0&&i[0].timestamp&&i[0].renames)return void issues.invalid.push({file:e,reason:"Rename log file"});let t=0,n=0;if(i.forEach(e=>{e.elements&&e.elements.forEach(e=>{n++,e.steps&&(t+=e.steps.length)})}),0===t)return void issues.empty.push({file:e,size:l.size});const r=`${t}-${n}`;issues.duplicates.has(r)||issues.duplicates.set(r,[]),issues.duplicates.get(r).push({file:e,steps:t,scenarios:n})}catch(o){issues.invalid.push({file:e,reason:o.message})}}),console.log("ğŸ“Š SCAN RESULTS:\n"),issues.empty.length>0&&(console.log(`âŒ Empty Reports (${issues.empty.length}):`),issues.empty.forEach(e=>console.log(`   - ${e.file} (${e.size} bytes)`)),console.log("")),issues.invalid.length>0&&(console.log(`âŒ Invalid Reports (${issues.invalid.length}):`),issues.invalid.forEach(e=>console.log(`   - ${e.file}: ${e.reason}`)),console.log(""));const duplicateGroups=Array.from(issues.duplicates.entries()).filter(([e,s])=>s.length>1);duplicateGroups.length>0&&(console.log(`âš ï¸  Potential Duplicates (${duplicateGroups.length} groups):`),duplicateGroups.forEach(([e,s])=>{console.log(`   Group: ${s[0].steps} steps, ${s[0].scenarios} scenarios (${s.length} files)`),s.forEach(e=>console.log(`      - ${e.file}`))}),console.log(""));const toDelete=[...issues.empty.map(e=>e.file),...issues.invalid.map(e=>e.file)];toDelete.length>0?(console.log(`\nğŸ—‘ï¸  FILES TO DELETE (${toDelete.length}):\n`),toDelete.forEach(e=>console.log(`   - ${e}`)),fs.writeFileSync(path.join(reportsDir,".cleanup-list.json"),JSON.stringify({toDelete,duplicateGroups:duplicateGroups.map(([e,s])=>s)},null,2)),console.log("\nğŸ’¾ Cleanup list saved to .cleanup-list.json"),console.log("\nâš ï¸  Review the list, then run: node execute-cleanup.js")):console.log("âœ… No problematic files found!");